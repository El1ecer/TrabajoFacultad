{% extends "plantilla.html" %}
{% load static %}
{% block contenido %}

<div class="col-md-3"></div>
<div class="col-md-6"></div>
<h1>EDITAR CARRERA</h1>

<form action="{% url 'guardarEdicionCarrera' %}" method="post" id="frm_editarCarrera" enctype="multipart/form-data">
    {% csrf_token %}
    
    <input type="hidden" name="id" value="{{ carrera.id }}">

    <label for="facultad">Facultad:</label><br>
    <select class="form-control" name="facultad" id="facultad" required>
        {% for f in facultades %}
            <option value="{{ f.id }}" {% if carrera.facultad.id == f.id %}selected{% endif %}>
                {{ f.nombre_facultad }} ({{ f.acronym_fac }})
            </option>
        {% endfor %}
    </select>
    <br>

    <label for="name_career">Nombre de la Carrera:</label><br>
    <input class="form-control" type="text" name="name_career" id="name_career" value="{{ carrera.name_career }}"> <br>

    <label for="directory_car">Director de Carrera:</label><br>
    <input class="form-control" type="text" name="directory_car" id="directory_car" value="{{ carrera.directory_car }}"> <br>

    <label for="duration_years">Duración (en años):</label><br>
    <input class="form-control" type="number" name="duration_years" id="duration_years" value="{{ carrera.duration_years }}"> <br>

    <label for="phone_car">Teléfono:</label><br>
    <input class="form-control" type="text" name="phone_car" id="phone_car" value="{{ carrera.phone_car }}"> <br>

    <label for="email_car">Email:</label><br>
    <input class="form-control" type="email" name="email_car" id="email_car" value="{{ carrera.email_car }}"> <br>

    <!-- Logo actual -->
    <label for="logo">Logotipo:</label><br>
    {% if carrera.logo %}
        <img src="{{ carrera.logo.url }}" alt="Logo actual" width="120"><br><br>
    {% else %}
        <small>No hay logotipo cargado</small><br><br>
    {% endif %}
    <!-- Subir nuevo logotipo -->
    <input class="form-control" type="file" name="logo" id="logo">
    <br>

    <button class="btn btn-success" type="submit">GUARDAR</button>
    <a class="btn btn-outline-danger" href="{% url 'inicioCareer' %}">CANCELAR</a>

</form>

<!-- Validaciones -->
<script>
    $("#frm_editarCarrera").validate({
        rules: {
            "facultad": {
                required: true
            },
            "name_career": {
                required: true,
                minlength: 3
            },
            "directory_car": {
                required: true,
                minlength: 5
            },
            "duration_years": {
                required: true,
                digits: true,
                min: 1,
                max: 10
            },
            "phone_car": {
                required: true,
                digits: true,
                minlength: 7,
                maxlength: 15
            },
            "email_car": {
                required: true,
                email: true
            }
        },
        messages: {
            "facultad": {
                required: "Debe seleccionar una facultad"
            },
            "name_career": {
                required: "Campo obligatorio",
                minlength: "Debe tener al menos 3 caracteres"
            },
            "directory_car": {
                required: "Ingrese el nombre del director",
                minlength: "Debe tener al menos 5 caracteres"
            },
            "duration_years": {
                required: "Ingrese los años de duración",
                digits: "Debe ser un número",
                min: "Al menos 1 año",
                max: "No puede superar 10 años"
            },
            "phone_car": {
                required: "Ingrese un teléfono",
                digits: "Solo se permiten números",
                minlength: "El teléfono es muy corto",
                maxlength: "El teléfono es demasiado largo"
            },
            "email_car": {
                required: "Ingrese un correo electrónico",
                email: "Debe ingresar un email válido"
            }
        }
    });
</script>

<!-- Configuración del fileinput -->
<script>
    $("#logo").fileinput({
        theme: "bootstrap5",  
        language: "es",
        allowedFileExtensions: ["jpg", "jpeg", "png"],
        showUpload: false,
        dropZoneEnabled: true,
        maxFileSize: 2000,
        showPreview: true,
        browseLabel: "Seleccionar logo",
        removeLabel: "Eliminar",
        initialCaption: "Arrastra y suelta la imagen aquí",
        showRemove: true,
        showZoom: true,
        showDrag: true
    });
</script>

{% endblock %}
